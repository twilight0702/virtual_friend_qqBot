import{j as e,b as x,u as y,k as v,d as u,i as B,e as L,f as w,s as P,W as R}from"./index-BzAQRMoo.js";import{r as d,u as k,c as N,R as p,m as I,O as T}from"./react-router-dom-BfuE-jt0.js";import{u as z}from"./use-dialog-CY9ehkO4.js";import{c as Q,b as F,a as K}from"./chunk-B75B6XQK-CzgPCciq.js";import{M as U,a as q,b as W,c as _,d as H}from"./index-Cw_yXam4.js";import{I as G,Q as J}from"./qq_manager-TkF5FQAs.js";import{l as V}from"./logo-juTWEVZj.js";import{m as g}from"./proxy-ChW5kn7J.js";import{s as X}from"./site-C5G2tDVc.js";import{A as S}from"./index-BnHhuIek.js";import"./react-dom-_uqhELNW.js";import"./monaco-editor-D8uW_Xv_.js";import"./react-hot-toast-C9oLzaEU.js";import"./react-icons-BOjVsZdF.js";import"./usePress-CUUJK2QJ.js";const Y=d.createContext(null),j={didCatch:!1,error:null};class Z extends d.Component{constructor(r){super(r),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=j}static getDerivedStateFromError(r){return{didCatch:!0,error:r}}resetErrorBoundary(){const{error:r}=this.state;if(r!==null){for(var t,s,a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];(t=(s=this.props).onReset)===null||t===void 0||t.call(s,{args:i,reason:"imperative-api"}),this.setState(j)}}componentDidCatch(r,t){var s,a;(s=(a=this.props).onError)===null||s===void 0||s.call(a,r,t)}componentDidUpdate(r,t){const{didCatch:s}=this.state,{resetKeys:a}=this.props;if(s&&t.error!==null&&$(r.resetKeys,a)){var i,o;(i=(o=this.props).onReset)===null||i===void 0||i.call(o,{next:a,prev:r.resetKeys,reason:"keys"}),this.setState(j)}}render(){const{children:r,fallbackRender:t,FallbackComponent:s,fallback:a}=this.props,{didCatch:i,error:o}=this.state;let c=r;if(i){const f={error:o,resetErrorBoundary:this.resetErrorBoundary};if(typeof t=="function")c=t(f);else if(s)c=d.createElement(s,f);else if(a!==void 0)c=a;else throw o}return d.createElement(Y.Provider,{value:{didCatch:i,error:o,resetErrorBoundary:this.resetErrorBoundary}},c)}}function $(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return n.length!==r.length||n.some((t,s)=>!Object.is(t,r[s]))}function ee({error:n,resetErrorBoundary:r}){return e.jsxs("div",{className:"pt-32 flex flex-col justify-center items-center",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(U,{className:"mr-2",color:"red",size:30}),e.jsx("h1",{className:"text-2xl",children:"出错了"})]}),e.jsxs("div",{className:"my-6 flex flex-col justify-center items-center",children:[e.jsx("p",{className:"mb-2",children:"错误信息"}),e.jsx(Q,{children:n.message})]}),e.jsx(x,{color:"primary",size:"md",onPress:r,children:"重试"})]})}const A=(n,r=!1)=>n==null?void 0:n.map(t=>{var C;const s=k(),a=N(),[i,o]=p.useState(!!t.autoOpen),c=p.useMemo(()=>t.items&&t.items.length>0,[t.items]),[f]=y(v.backgroundImage,""),[m]=y(v.customIcons,{}),l=p.useMemo(()=>t.href?!!I(t.href,a.pathname):!1,[t.href,a.pathname]),h=M=>{s(M)};p.useEffect(()=>{t.items&&t.items.some(b=>(b==null?void 0:b.href)&&!!I(b.href,a.pathname))&&o(!0)},[t.items,a.pathname]);const E=p.useRef(null);return e.jsxs("div",{children:[e.jsx(x,{className:u("flex items-center w-full text-left justify-start dark:text-white",l&&"bg-opacity-60",f&&"backdrop-blur-md text-white"),color:"primary",endContent:c?e.jsx("div",{className:u("ml-auto relative w-3 h-3 transition-transform",i&&"transform rotate-180",l?"text-primary-500":"text-primary-200 dark:text-white","before:rounded-full",'before:content-[""]',"before:block","before:absolute","before:w-3","before:h-[4.5px]","before:bg-current","before:top-1/2","before:-left-[3px]","before:transform","before:-translate-y-1/2","before:rotate-45","after:rounded-full",'after:content-[""]',"after:block","after:absolute","after:w-3","after:h-[4.5px]","after:bg-current","after:top-1/2","after:left-[3px]","after:transform","after:-translate-y-1/2","after:-rotate-45")}):e.jsx("div",{className:u("w-3 h-1.5 rounded-full ml-auto shadow-lg",l?"bg-primary-500 animate-spinner-ease-spin":"bg-primary-200 dark:bg-white")}),radius:"full",startContent:m[t.label]?e.jsx(B,{radius:"none",src:m[t.label],alt:t.label,className:"w-5 h-5"}):t.icon,variant:l?r?"solid":"shadow":"light",onPress:()=>{t.href?l||h(t.href):c&&o(!i)},children:t.label}),e.jsx("div",{ref:E,className:"ml-4 overflow-hidden transition-all duration-300",style:{height:i?(C=E.current)==null?void 0:C.scrollHeight:0},children:t.items&&A(t.items,!0)})]},t.href+t.label)}),te=n=>{const{items:r}=n;return e.jsx("div",{className:"flex flex-col justify-content-center flex-1 gap-2",children:A(r)})},re=n=>{const{open:r,items:t}=n,{toggleTheme:s,isDark:a}=L(),{revokeAuth:i}=w(),o=z(),c=()=>{o.confirm({title:"退出登录",content:"确定要退出登录吗？",onConfirm:i})};return e.jsx(g.div,{className:u("overflow-hidden fixed top-0 left-0 h-full z-50 bg-background md:bg-transparent md:static shadow-md md:shadow-none rounded-r-md md:rounded-none"),initial:{width:0},animate:{width:r?"16rem":0},transition:{type:r?"spring":"tween",stiffness:150,damping:r?15:10},style:{overflow:"hidden"},children:e.jsxs(g.div,{className:"w-64 flex flex-col items-stretch h-full transition-transform duration-300 ease-in-out z-30 relative float-right",children:[e.jsxs("div",{className:"flex justify-center items-center my-2 gap-2",children:[e.jsx(B,{radius:"none",height:40,src:V,className:"mb-2"}),e.jsx("div",{className:u("flex items-center font-bold","!text-2xl shiny-text"),children:"NapCat"})]}),e.jsxs("div",{className:"overflow-y-auto flex flex-col flex-1 px-4",children:[e.jsx(te,{items:t}),e.jsxs("div",{className:"mt-auto mb-10 md:mb-0",children:[e.jsx(x,{className:"w-full",color:"primary",radius:"full",variant:"light",onPress:s,startContent:a?e.jsx(W,{size:16}):e.jsx(q,{size:16}),children:"切换主题"}),e.jsx(x,{className:"w-full mb-2",color:"primary",radius:"full",variant:"light",onPress:c,startContent:e.jsx(G,{size:16}),children:"退出登录"})]})]})]})})},O=X.navItems,D=(n,r)=>{const t=[];if(r){for(const s of n)if(s.href===r)t.push(s.label);else if(s.items){const a=D(s.items,r);a.length>0&&(t.push(s.label),t.push(...a))}}return t},se=({children:n})=>{const r=N(),t=d.useRef(null),[s,a]=y(v.sideBarOpen,!0),[i]=y(v.backgroundImage,""),o=k(),{isAuth:c}=w(),f=async()=>{try{(await J.checkQQLoginStatus()).isLogin||(c?o("/qq_login",{replace:!0}):o("/web_login",{replace:!0}))}catch{o("/web_login",{replace:!0})}};d.useEffect(()=>{var l,h;(h=(l=t==null?void 0:t.current)==null?void 0:l.scrollTo)==null||h.call(l,{top:0,behavior:"smooth"})},[r.pathname]),d.useEffect(()=>{c&&f()},[c]);const m=d.useMemo(()=>D(O,r.pathname),[r.pathname]);return e.jsxs("div",{className:"h-screen relative flex bg-primary-50 dark:bg-black items-stretch",style:{backgroundImage:`url(${i})`,backgroundSize:"cover"},children:[e.jsx(re,{items:O,open:s}),e.jsxs("div",{ref:t,className:u("overflow-y-auto flex-1 rounded-md m-1 bg-content1 pb-10 md:pb-0",s?"ml-0":"ml-1",!i&&"shadow-inner",i&&"!bg-opacity-50 backdrop-blur-none dark:bg-background","overflow-x-hidden"),children:[e.jsxs("div",{className:u("h-10 flex items-center font-bold text-xl backdrop-blur-lg rounded-full","dark:bg-background dark:shadow-primary-100","bg-background !bg-opacity-50","shadow-sm shadow-primary-50","z-30 m-2 mb-0 sticky top-2 left-0"),children:[e.jsx(g.div,{className:u("mr-1 ease-in-out ml-0 md:relative",s&&"pl-2 absolute","md:!ml-0 md:pl-0"),transition:{type:"spring",stiffness:150,damping:15},initial:{marginLeft:0},animate:{marginLeft:s?"15rem":0},children:e.jsx(x,{isIconOnly:!0,radius:"full",variant:"light",onPress:()=>a(!s),children:s?e.jsx(_,{size:24}):e.jsx(H,{size:24})})}),e.jsx(F,{isDisabled:!0,size:"lg",children:m==null?void 0:m.map((l,h)=>e.jsx(K,{children:e.jsx(S,{mode:"wait",children:e.jsx(g.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},transition:{duration:.3},children:l},l)})},h))})]}),e.jsx(Z,{fallbackRender:ee,children:n})]})]})},ae=()=>{const{isAuth:n}=w(),r=z(),t=k(),s=async()=>{await R.checkUsingDefaultToken()&&r.confirm({title:"修改默认密码",content:"检测到当前密码为默认密码，请尽快修改密码。",confirmText:"前往修改",onConfirm:()=>{t("/config?tab=token")}})};return d.useEffect(()=>{n&&s()},[n]),null};function ve(){const n=N();return e.jsxs(se,{children:[e.jsx(ae,{}),e.jsx(d.Suspense,{fallback:e.jsx("div",{className:"flex justify-center px-10",children:e.jsx(P,{})}),children:e.jsx(S,{mode:"wait",children:e.jsx(g.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{type:"tween",ease:"easeInOut"},children:e.jsx(T,{})},n.pathname)})})]})}export{ve as default};
